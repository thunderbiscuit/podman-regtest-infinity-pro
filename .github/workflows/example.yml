name: Example Using Pre-Built Container

# This workflow demonstrates how other projects can use the pre-built
# regtest container in their CI pipelines

on:
  workflow_dispatch:

jobs:
  test-with-regtest:
    runs-on: ubuntu-24.04

    services:
      bitcoin-regtest:
        image: ghcr.io/thunderbiscuit/podman-regtest-infinity-pro:0.3.0
        ports:
          - 18443:18443
          - 18444:18444
          - 3002:3002
          - 3003:3003
          - 60401:60401
        # The container initialization step will wait until everything is ready before allowing other steps to run
        options: >-
          --health-cmd "test $(bitcoin-cli -regtest -rpcuser=regtest -rpcpassword=password getblockcount) -gt 0"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 6

    steps:
      - name: Test Bitcoin RPC
        run: |
          echo "Testing connection to Bitcoin regtest node..."
          curl --user regtest:password --data-binary '{"jsonrpc":"1.0","id":"test","method":"getblockchaininfo","params":[]}' \
            -H 'content-type: text/plain;' http://localhost:18443/ | jq

      - name: Run your tests here
        run: |
          echo "This is where you would run your actual test suite"
          echo "The regtest environment is fully operational!"
